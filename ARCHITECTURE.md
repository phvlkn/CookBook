# 🏗️ Архитектура CookBook

## 📊 Общая структура приложения

```
╔════════════════════════════════════════════════════════════════╗
║                        FRONTEND (React)                        ║
║                                                                ║
║  ┌──────────────────────────────────────────────────────────┐ ║
║  │                      App.jsx                             │ ║
║  │  - Маршрутизация (React Router)                          │ ║
║  │  - Инициализация данных (seedInitialData)               │ ║
║  │  - Окно DEBUG для тестирования                           │ ║
║  └──────────────────────────────────────────────────────────┘ ║
║                            ↓                                   ║
║  ┌──────────────────────────────────────────────────────────┐ ║
║  │                       Компоненты                         │ ║
║  │                                                          │ ║
║  │  1. Header              - Шапка со строкой поиска       │ ║
║  │  2. Homepage            - Главная страница с рецептами   │ ║
║  │  3. Upload              - Форма создания рецепта         │ ║
║  │  4. Recipe              - Страница рецепта с отзывами   │ ║
║  │  5. Profilepage         - Профиль пользователя           │ ║
║  │  6. Loginpage           - Вход в аккаунт                │ ║
║  │  7. Registerpage        - Регистрация аккаунта          │ ║
║  │                                                          │ ║
║  └──────────────────────────────────────────────────────────┘ ║
║                            ↓                                   ║
║  ┌──────────────────────────────────────────────────────────┐ ║
║  │                    storage.js (утилиты)                  │ ║
║  │                                                          │ ║
║  │  UserStorage:                  RecipeStorage:            │ ║
║  │  - registerUser()              - createRecipe()          │ ║
║  │  - loginUser()                 - getRecipes()            │ ║
║  │  - getCurrentUser()            - getRecipeById()         │ ║
║  │  - logout()                    - deleteRecipe()          │ ║
║  │  - updateUser()                - getRecipesByUser()      │ ║
║  │  - getUsers()                  - searchRecipes()         │ ║
║  │                                - addReview()             │ ║
║  │                                                          │ ║
║  │  seedInitialData() - загружает 10 примеров              │ ║
║  │                                                          │ ║
║  └──────────────────────────────────────────────────────────┘ ║
║                            ↓                                   ║
║  ┌──────────────────────────────────────────────────────────┐ ║
║  │                      localStorage                        │ ║
║  │                                                          │ ║
║  │  Ключ: 'cookbook_users'                                 │ ║
║  │  Хранит: [                                              │ ║
║  │    { id, email, password, username, avatar, bio }       │ ║
║  │  ]                                                       │ ║
║  │                                                          │ ║
║  │  Ключ: 'cookbook_recipes'                               │ ║
║  │  Хранит: [                                              │ ║
║  │    {                                                    │ ║
║  │      id, title, description, cookTime, category,        │ ║
║  │      ingredients, steps, image, authorId,               │ ║
║  │      rating, reviews, createdAt                         │ ║
║  │    }                                                    │ ║
║  │  ]                                                       │ ║
║  │                                                          │ ║
║  │  Ключ: 'cookbook_loggedInUser'                          │ ║
║  │  Хранит: { текущий залогиненный пользователь }          │ ║
║  │                                                          │ ║
║  └──────────────────────────────────────────────────────────┘ ║
║                                                                ║
╚════════════════════════════════════════════════════════════════╝
```

---

## 🔄 Жизненный цикл рецепта

```
START
  ↓
[1. СОЗДАНИЕ]
  ├─ Пользователь открывает страницу Upload
  ├─ Проверяется авторизация (if not logged in → redirect /login)
  ├─ Заполняет форму
  ├─ Нажимает "Опубликовать"
  ↓
[2. ВАЛИДАЦИЯ]
  ├─ Проверяется: название не пусто
  ├─ Проверяется: описание не пусто
  ├─ Проверяется: все ингредиенты заполнены
  ├─ Проверяется: все шаги заполнены
  ├─ Если ошибка → показывается красное сообщение
  ↓
[3. СОХРАНЕНИЕ]
  ├─ RecipeStorage.createRecipe() создает объект рецепта
  ├─ Автоматически генерируется ID = Date.now()
  ├─ Присваивается authorId = currentUser.id
  ├─ Рецепт добавляется в массив 'cookbook_recipes'
  ├─ localStorage обновляется
  ├─ Показывается зеленое "Рецепт опубликован!"
  ↓
[4. ОТОБРАЖЕНИЕ НА ГЛАВНОЙ]
  ├─ Homepage загружает RecipeStorage.getRecipes()
  ├─ Получает все рецепты
  ├─ Рендерит карточки в grid
  ├─ ✨ РЕЦЕПТ ВИДЕН НА ГЛАВНОЙ ✨
  ↓
[5. ПРОСМОТР]
  ├─ Пользователь кликает на карточку
  ├─ Переходит на /recipe/:id
  ├─ Загружается полная информация
  ├─ Показываются ингредиенты, шаги, отзывы
  ↓
[6. ОТЗЫВЫ И ОЦЕНКИ]
  ├─ Логиненный пользователь может оставить отзыв
  ├─ Выбирает рейтинг (1-5 звезд)
  ├─ Пишет комментарий
  ├─ RecipeStorage.addReview() сохраняет отзыв
  ├─ Пересчитывается средний рейтинг
  ├─ Рейтинг обновляется на карточке рецепта
  ↓
[7. УПРАВЛЕНИЕ (в профиле)]
  ├─ Автор может посмотреть свой рецепт в профиле
  ├─ Кнопка "Удалить" есть только для автора
  ├─ RecipeStorage.deleteRecipe() удаляет рецепт
  ├─ Рецепт исчезает с главной страницы
  ↓
END
```

---

## 🔐 Система аутентификации

```
┌─────────────────────────────────────────┐
│         РЕГИСТРАЦИЯ НОВОГО ПОЛЬЗОВАТЕЛЯ │
└─────────────────────────────────────────┘
             ↓
  Registerpage компонент
             ↓
  1. email, password, username
  2. UserStorage.registerUser(email, password, username)
  3. Проверка: email уже существует?
  4. Если нет → создается новый пользователь
  5. Пользователь добавляется в 'cookbook_users'
  6. Редирект на /login
             ↓
┌─────────────────────────────────────────┐
│            ВХОД В АККАУНТ                │
└─────────────────────────────────────────┘
             ↓
  Loginpage компонент
             ↓
  1. email, password
  2. UserStorage.loginUser(email, password)
  3. Поиск пользователя в 'cookbook_users'
  4. Проверка пароля
  5. Если верно → пользователь сохраняется в 'cookbook_loggedInUser'
  6. Редирект на /
             ↓
┌─────────────────────────────────────────┐
│       ИСПОЛЬЗОВАНИЕ АККАУНТА             │
└─────────────────────────────────────────┘
             ↓
  Любой компонент может получить текущего пользователя:
  const currentUser = UserStorage.getCurrentUser()
             ↓
  Проверить авторизацию:
  if (!currentUser) navigate("/login")
             ↓
  Использовать в рецепте:
  RecipeStorage.createRecipe(..., currentUser.id)
             ↓
┌─────────────────────────────────────────┐
│            ВЫХОД ИЗ АККАУНТА             │
└─────────────────────────────────────────┘
             ↓
  Header компонент → кнопка "Logout"
             ↓
  UserStorage.logout()
             ↓
  Удаляется 'cookbook_loggedInUser'
             ↓
  Редирект на /
```

---

## 🔍 Поиск рецептов

```
USER ВВОДИТ ПОИСК
  ↓
Header компонент → input с placeholder "Поиск"
  ↓
handleSearch() отправляет query в Homepage
  ↓
Homepage компонент → setSearchQuery(query)
  ↓
if (query.trim() === "") {
  setFilteredRecipes(recipes)  // Показать все
} else {
  const results = RecipeStorage.searchRecipes(query)
  setFilteredRecipes(results)  // Показать найденные
}
  ↓
RecipeStorage.searchRecipes() ищет в:
  - Названии рецепта (title)
  - Описании (description)
  - Категории (category)
  - Ингредиентах (ingredients[].name)
  ↓
РЕЗУЛЬТАТЫ ОТОБРАЖАЮТСЯ В GRID
```

---

## 👤 Профиль пользователя

```
ПОЛЬЗОВАТЕЛЬ КЛИКАЕТ НА АВАТАР
  ↓
Header компонент → Link to="/profile/:id"
  ↓
Profilepage загружает:
  1. Пользователя по ID из URL параметров
  2. Все рецепты этого пользователя
  3. Текущего залогиненного пользователя
  ↓
ОТОБРАЖАЕТ:
  - Аватар и информация о пользователе
  - Все его рецепты в grid
  ↓
ЕСЛИ ТЕКУЩИЙ ПОЛЬЗОВАТЕЛЬ = АВТОР:
  - Показывается кнопка "Удалить" для каждого рецепта
  - onClick → RecipeStorage.deleteRecipe()
  ↓
ЕСЛИ ТЕКУЩИЙ ПОЛЬЗОВАТЕЛЬ ≠ АВТОР:
  - Кнопка удаления не видна
  - Можно только просматривать
```

---

## 📱 Таблица маршрутов

| Маршрут | Компонент | Описание | Требует авто |
|---------|-----------|---------|-------------|
| `/` | Homepage | Главная - все рецепты | Нет |
| `/login` | Loginpage | Вход в аккаунт | Нет |
| `/register` | Registerpage | Регистрация | Нет |
| `/upload` | Upload | Создание рецепта | **Да** ✓ |
| `/profile/:id` | Profilepage | Профиль пользователя | Нет |
| `/recipe/:id` | Recipe | Страница рецепта | Нет |
| `/*` | NotFound | 404 страница | Нет |

---

## 💾 Размер данных в localStorage

```
Пользователь:
  id:      8 байт (число)
  email:   ~30 байт (строка)
  password: ~20 байт (строка)
  username: ~20 байт (строка)
  avatar:   ~30 байт (путь)
  ─────────────────────────
  ИТОГО:   ~150 байт на пользователя

Рецепт:
  id:          8 байт
  title:       ~50 байт
  description: ~200 байт
  ingredients: ~300 байт (массив)
  steps:       ~400 байт (массив)
  image:       ~100 байт (URL)
  authorId:    8 байт
  reviews:     ~500 байт (для 10 отзывов)
  ─────────────────────────
  ИТОГО:      ~1600 байт на рецепт

10 рецептов + 10 пользователей ≈ 20 KB
```

---

## 🎯 Компоненты и их ответственность

```
Header
  - Отображает лого/название
  - Поле поиска
  - Меню пользователя (Login/Profile/Logout)

Homepage
  - Загружает все рецепты
  - Отображает в grid
  - Фильтрует по поиску
  - Навигация на рецепт

Upload
  - Форма создания рецепта
  - Валидация
  - Сохранение в storage
  - Редирект на рецепт

Recipe
  - Загружает полные данные рецепта
  - Показывает автора
  - Форма добавления отзывов
  - Список отзывов

Profilepage
  - Информация о пользователе
  - Рецепты пользователя
  - Кнопка удаления (если автор)

Loginpage
  - Форма входа
  - Валидация
  - Сохранение сессии

Registerpage
  - Форма регистрации
  - Проверка на дубликат email
  - Создание пользователя
```

---

**Это полностью функциональная архитектура! 🏗️**
